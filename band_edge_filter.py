import numpy as np


class BandEdgeFilter:
    def __init__(self):
        self.ggp_coeffs = None
        self.ggp_coeffs_de_rotated = None

    def load_coefficients(self):
        self.ggp_coeffs_de_rotated = list(range(321))
        self.ggp_coeffs = (9.86453091348717e-05 - 1.46326493465463e-05j, 9.79737719917650e-05 + 1.45330362212553e-05j,
                           8.54151285330608e-05 + 4.03983471243676e-05j, 6.38147752845319e-05 + 5.78383409207291e-05j,
                           3.81403675569898e-05 + 6.36333589327448e-05j, 1.43469766638758e-05 + 5.72763414627199e-05j,
                           -2.02172824053008e-06 + 4.11532237466280e-05j, -7.16944093876045e-06 + 2.00372451072638e-05j,
                           -1.14731580839855e-34 + 1.54697628710127e-34j, 1.75503527172850e-05 - 1.30162286800413e-05j,
                           4.08969002941599e-05 - 1.46331449092800e-05j, 6.38340316599014e-05 - 3.13596488353516e-06j,
                           7.99785651192518e-05 + 2.00335876571837e-05j, 8.42956750585898e-05 + 5.05248832392655e-05j,
                           7.43455872806918e-05 + 8.20277150102974e-05j, 5.09459352275943e-05 + 0.000107716129877927j,
                           1.80756256633810e-05 + 0.000121855970107782j, -1.79779040662943e-05 + 0.000121197184612036j,
                           -5.00457136018288e-05 + 0.000105812771167823j, -7.17543327212038e-05 + 7.91687061800570e-05j,
                           -7.90596277649228e-05 + 4.73865172677739e-05j, -7.12675088429227e-05 + 1.78515816504706e-05j,
                           -5.12832480534903e-05 - 2.51938442281430e-06j, -2.50077245137168e-05 - 8.94790690806531e-06j,
                           0.00000000000000 + 0.00000000000000j, 1.62959083474532e-05 + 2.19724888350262e-05j,
                           1.83494991719543e-05 + 5.12834146545813e-05j, 3.93877189372032e-06 + 8.01755437648362e-05j,
                           -2.52035457622639e-05 + 0.000100618194827446j, -6.36695683096434e-05 + 0.000106226257187654j,
                           -0.000103543181242507 + 9.38460691903818e-05j, -0.000136203040258867 + 6.44192404117507e-05j,
                           -0.000154350895469858 + 2.28957925069496e-05j, -0.000153788024171575 - 2.28122984370623e-05j,
                           -0.000134507759959097 - 6.36174325446975e-05j, -0.000100821685648107 - 9.13794493629002e-05j,
                           -6.04586599623318e-05 - 0.000100869180251798j, -2.28189782836452e-05 - 9.10984678253010e-05j,
                           3.22658005027082e-06 - 6.56785457527156e-05j, 1.14818274484026e-05 - 3.20895580043269e-05j,
                           0.00000000000000 + 0.00000000000000j, -2.83069000307093e-05 + 2.09938278710434e-05j,
                           -6.62022261904597e-05 + 2.36875352947044e-05j, -0.000103713318081118 + 5.09510859646410e-06j,
                           -0.000130430993294837 - 3.26712630251567e-05j, -0.000137994857468073 - 8.27109345330887e-05j,
                           -0.000122176958002573 - 0.000134801500108169j, -8.40517708229512e-05 - 0.000177712538242522j,
                           -2.99406517398575e-05 - 0.000201843478691352j, 2.98996144563433e-05 - 0.000201566827797695j,
                           8.35758427547995e-05 - 0.000176706272887441j, 0.000120331354111542 - 0.000132765190011864j,
                           0.000133147317932374 - 7.98054311502781e-05j, 0.000120544437223378 - 3.01948096480557e-05j,
                           8.71246015087044e-05 + 4.28015720954307e-06j, 4.26758039438986e-05 + 1.52696468128240e-05j,
                           0.00000000000000 + 0.00000000000000j, -2.80654330486581e-05 - 3.78418558305272e-05j,
                           -3.17513770971571e-05 - 8.87391542552969e-05j, -6.84826424255904e-06 - 0.000139399621076772j,
                           4.40351805991239e-05 - 0.000175798295310433j, 0.000111796098324944 - 0.000186520521632671j,
                           0.000182730922368851 - 0.000165617654181265j, 0.000241609181206125 - 0.000114272632242440j,
                           0.000275241107306390 - 4.08281614634417e-05j, 0.000275706350665813 + 4.08971737966080e-05j,
                           0.000242457444194396 + 0.000114673830756585j, 0.000182747379192800 + 0.000165632569777063j,
                           0.000110207500159908 + 0.000183870105716135j, 4.18361820424864e-05 + 0.000167019400972151j,
                           -5.95046246204744e-06 + 0.000121124445999906j, -2.13020998746802e-05 + 5.95353808106240e-05j,
                           1.14731580839855e-34 - 1.54697628710127e-34j, 5.31702024960573e-05 - 3.94337097265955e-05j,
                           0.000125144961129268 - 4.47775830857358e-05j, 0.000197331931134648 - 9.69429613557083e-06j,
                           0.000249818630177984 + 6.25763092724395e-05j, 0.000266102610862610 + 0.000159495766943586j,
                           0.000237236099232624 + 0.000261749699609435j, 0.000164364745006249 + 0.000347520055159496j,
                           5.89740110027484e-05 + 0.000397570488331452j, -5.93297028316982e-05 + 0.000399968367867307j,
                           -0.000167096153388166 + 0.000353295132968977j, -0.000242447674601209 + 0.000267499786934389j,
                           -0.000270397214288434 + 0.000162069853176335j, -0.000246789861137951 + 6.18176421224797e-05j,
                           -0.000179851450121077 - 8.83553517091941e-06j, -8.88451067481620e-05 - 3.17892875052922e-05j,
                           -1.54697628710127e-34 - 1.14731580839855e-34j, 5.94635305401044e-05 + 8.01772894781814e-05j,
                           6.78885937106299e-05 + 0.000189735908808886j, 1.47798285345585e-05 + 0.000300850321238074j,
                           -9.59503408844065e-05 + 0.000383055232939575j, -0.000246001945624854 + 0.000410429450652501j,
                           -0.000406163326980158 + 0.000368124981567863j, -0.000542619033494649 + 0.000256639689571161j,
                           -0.000624753624520853 + 9.26734458614629e-05j, -0.000632677236444649 - 9.38488026610508e-05j,
                           -0.000562655211765407 - 0.000266116096136710j, -0.000429009092253266 - 0.000388831176247222j,
                           -0.000261805147438696 - 0.000436795500004393j, -0.000100605182277761 - 0.000401638401459807j,
                           1.44902776803070e-05 - 0.000294956378198560j, 5.25496385291561e-05 - 0.000146866400951043j,
                           0.00000000000000 + 0.00000000000000j, -0.000134766082314390 + 9.99493385674093e-05j,
                           -0.000321726106241155 + 0.000115115441509330j, -0.000514788327451815 + 2.52899288258002e-05j,
                           -0.000661640856895630 - 0.000165732406982157j, -0.000715865320905526 - 0.000429073160973581j,
                           -0.000648601158000521 - 0.000715621099917421j, -0.000456943837529141 - 0.000966126571831936j,
                           -0.000166812202550632 - 0.00112455652413754j, 0.000170852948434218 - 0.00115179702019410j,
                           0.000490213861304465 - 0.00103647012693628j, 0.000725117598947521 - 0.000800043982850685j,
                           0.000825058166674963 - 0.000494520834050868j, 0.000768850654223059 - 0.000192587063217429j,
                           0.000572562381208970 + 2.81281860853017e-05j, 0.000289282304903574 + 0.000103506863769552j,
                           0.00000000000000 + 0.00000000000000j, -0.000203122849346674 - 0.000273879457606668j,
                           -0.000237905245785948 - 0.000664900619565053j, -5.31960571853041e-05 - 0.00108283061981244j,
                           0.000355140872104620 - 0.00141780183620492j, 0.000937604314720046 - 0.00156429829383059j,
                           0.00159638553058501 - 0.00144687950630885j, 0.00220276858377681 - 0.00104183194956644j,
                           0.00262396522298758 - 0.000389228472618141j, 0.00275429722220329 + 0.000408561398429652j,
                           0.00254406303884359 + 0.00120325220502005j, 0.00201915862338506 + 0.00183005870210565j,
                           0.00128575416853226 + 0.00214515123335491j, 0.000516944222320468 + 0.00206375701923031j,
                           -7.81338502369488e-05 + 0.00159045105891380j, -0.000298343313218116 + 0.000833813702369118j,
                           0.00000000000000 + 0.00000000000000j, 0.000858155633834218 - 0.000636451594619571j,
                           0.00218467346428517 - 0.000781688664725255j, 0.00374825983781229 - 0.000184140197949130j,
                           0.00519860673275137 + 0.00130218319771695j, 0.00611498423951959 + 0.00366518050299654j,
                           0.00607689392649720 + 0.00670481922845706j, 0.00474612332580268 + 0.0100348346594277j,
                           0.00194614236309072 + 0.0131198261149379j, -0.00227627064839379 + 0.0153453702379898j,
                           -0.00762059729846032 + 0.0161123992460094j, -0.0135424343955818 + 0.0149417738130494j,
                           -0.0193063611001942 + 0.0115717875167903j, -0.0240771652243537 + 0.00603101592707216j,
                           -0.0270376680015347 - 0.00132827545402812j, -0.0275158521781809 - 0.00984532933619783j,
                           -0.0251011253616994 - 0.0186162633365472j, -0.0197299994332067 - 0.0266028246488607j,
                           -0.0117253299708788 - 0.0327701019642776j, -0.00178002191350828 - 0.0362331784321855j,
                           0.00911528238401862 - 0.0363902471292596j, 0.0197919747161813 - 0.0330209148934058j,
                           0.0290542166566473 - 0.0263332070148212j, 0.0358386952122418 - 0.0169504404492953j,
                           0.0393594783448138 - 0.00583842708927215j, 0.0392159461637516 + 0.00581713610145077j,
                           0.0354472783412207 + 0.0167653140566127j, 0.0285252045521853 + 0.0258537383915652j,
                           0.0192863125279839 + 0.0321772685003236j, 0.00881456173956701 + 0.0351897030202092j,
                           -0.00170778272660759 + 0.0347627160019732j, -0.0111580399143575 + 0.0311846324686050j,
                           -0.0186162633365472 + 0.0251011253616994j, -0.0234730805725241 + 0.0174088230293000j,
                           -0.0254878570833270 + 0.00911970108846133j, -0.0247911220851795 + 0.00121790973029514j,
                           -0.0218341482775558 - 0.00546916943041117j, -0.0172966697060697 - 0.0103672248513331j,
                           -0.0119696395521915 - 0.0132064621166578j, -0.00663278104537642 - 0.0140238372569642j,
                           -0.00194614236309072 - 0.0131198261149379j, 0.00162879810840622 - 0.0109804649258505j,
                           0.00386891862844908 - 0.00818014115566631j, 0.00478772933177134 - 0.00528244528744173j,
                           0.00459675264290337 - 0.00275518750399770j, 0.00364031410553888 - 0.000911851214437967j,
                           0.00231751440013154 + 0.000113852181773838j, 0.00100595588608403 + 0.000359936771430888j,
                           0.00000000000000 + 0.00000000000000j, -0.000527540091796971 - 0.000711305471894672j,
                           -0.000536453005203607 - 0.00149928571078394j, -0.000104392262596726 - 0.00212495332158682j,
                           0.000607685492267905 - 0.00242601647528397j, 0.00140097633126123 - 0.00233738779811753j,
                           0.00208523086052492 - 0.00188994308718812j, 0.00251709899483973 - 0.00119049916199064j,
                           0.00262396522298758 - 0.000389228472618143j, 0.00241034595933303 + 0.000357541048186728j,
                           0.00194765265611103 + 0.000921171102011685j, 0.00135132321306649 + 0.00122476796859267j,
                           0.000751414773817554 + 0.00125365981170092j, 0.000263423684170967 + 0.00105164629715568j,
                           -3.46506640181247e-05 + 0.000705330469605253j, -0.000114873437690710 + 0.000321049750877886j,
                           0.00000000000000 + 0.00000000000000j, 0.000246779449432848 - 0.000183024113480584j,
                           0.000539742855882220 - 0.000193123081873299j, 0.000791649276669598 - 3.88912350850550e-05j,
                           0.000933083259724604 + 0.000233725189333809j, 0.000926134787933360 + 0.000555103829367655j,
                           0.000769976813298865 + 0.000849538498732377j, 0.000497845104105176 + 0.00105260503420570j,
                           0.000166812202550633 + 0.00112455652413754j, -0.000156816249204705 + 0.00105716928040922j,
                           -0.000412938769867307 + 0.000873085673429081j, -0.000560487036474611 + 0.000618402148352462j,
                           -0.000585041245460429 + 0.000350660227781526j, -0.000499962993729748 + 0.000125234210507509j,
                           -0.000341288936905768 - 1.67664503313506e-05j, -0.000157976861543084 - 5.65250248954280e-05j,
                           0.00000000000000 + 0.00000000000000j, 9.29199345362953e-05 + 0.000125288028173598j,
                           9.94876482377598e-05 + 0.000278049349999931j, 2.03163168354766e-05 + 0.000413548129603521j,
                           -0.000123736864941429 + 0.000493985255148321j, -0.000297664372269613 + 0.000496623002225135j,
                           -0.000461178042169004 + 0.000417987412933669j, -0.000578191497662288 + 0.000273464212114111j,
                           -0.000624753624520853 + 9.26734458614639e-05j, -0.000593752609544906 - 8.80748796903148e-05j,
                           -0.000495535111946235 - 0.000234370653167931j, -0.000354550565055411 - 0.000321345900912110j,
                           -0.000203013816084042 - 0.000338708089477090j, -7.31888243225704e-05 - 0.000292186165166736j,
                           9.88790660566825e-06 - 0.000201272962790581j, 3.36288122795583e-05 - 9.39862340825946e-05j,
                           -1.14731580839855e-34 + 1.54697628710127e-34j, -7.57915232161271e-05 + 5.62108245960304e-05j,
                           -0.000169542286585327 + 6.06632001449769e-05j, -0.000254107886864812 + 1.24835199832450e-05j,
                           -0.000305800396044199 - 7.65990116304087e-05j, -0.000309659048446261 - 0.000185602490944582j,
                           -0.000262457212772305 - 0.000289576910199142j, -0.000172879674325013 - 0.000365523360591102j,
                           -5.89740110027491e-05 - 0.000397570488331452j, 5.64075072173920e-05 - 0.000380268525214154j,
                           0.000151038865374888 - 0.000319344849920908j, 0.000208345144547412 - 0.000229873443277684j,
                           0.000220896580093755 - 0.000132400314837418j, 0.000191648990055598 - 4.80055729427609e-05j,
                           0.000132754507372514 + 6.52181073990919e-06j, 6.23277131284575e-05 + 2.23012123538124e-05j,
                           1.54697628710128e-34 + 1.14731580839854e-34j, -3.76670474097112e-05 - 5.07881341138995e-05j,
                           -4.08548082609018e-05 - 0.000114181539945218j, -8.44844281694342e-06 - 0.000171972004241844j,
                           5.20873279086774e-05 - 0.000207944269310055j, 0.000126797741338378 - 0.000211549250918732j,
                           0.000198729252097450 - 0.000180117695039817j, 0.000251962704873478 - 0.000119169484243456j,
                           0.000275241107306390 - 4.08281614634423e-05j, 0.000264377165148887 + 3.92166478749490e-05j,
                           0.000222938857491954 + 0.000105442226771149j, 0.000161126245288097 + 0.000146036316271551j,
                           9.31705919226281e-05 + 0.000155445741547457j, 3.39121937302076e-05 + 0.000135385066369553j,
                           -4.62455670648076e-06 + 9.41350143186891e-05j, -1.58720340175781e-05 + 4.43593633977310e-05j,
                           0.00000000000000 + 0.00000000000000j, 3.64056536568661e-05 - 2.70002729220053e-05j,
                           8.21305813641040e-05 - 2.93867919069646e-05j, 0.000124118924800636 - 6.09757177222898e-06j,
                           0.000150580332948660 + 3.77184098649046e-05j, 0.000153689626735831 + 9.21180172116418e-05j,
                           0.000131272218418849 + 0.000144836573562549j, 8.71239086485771e-05 + 0.000184208027932710j,
                           2.99406517398573e-05 + 0.000201843478691352j, -2.88453029824008e-05 + 0.000194459237175628j,
                           -7.77852492574045e-05 + 0.000164463091592425j, -0.000108043128298464 + 0.000119207222123713j,
                           -0.000115330711470694 + 6.91265682006599e-05j, -0.000100726489378948 + 2.52306721352747e-05j,
                           -7.02277090948951e-05 - 3.45006611435878e-06j, -3.31822009668066e-05 - 1.18727813517316e-05j,
                           0.00000000000000 + 0.00000000000000j, 2.03025308018179e-05 + 2.73747938350079e-05j,
                           2.21531200529427e-05 + 6.19138228744783e-05j, 4.60808859122632e-06 + 9.37997981317779e-05j,
                           -2.85745529279582e-05 + 0.000114076009809591j, -6.99542837471863e-05 + 0.000116711671430970j,
                           -0.000110248735099850 + 9.99236289456915e-05j, -0.000140543902793105 + 6.64723154874322e-05j,
                           -0.000154350895469858 + 2.28957925069501e-05j, -0.000149038101484970 - 2.21077139646135e-05j,
                           -0.000126326722527515 - 5.97480900093105e-05j, -9.17638328578228e-05 - 8.31698901290335e-05j,
                           -5.33262097547942e-05 - 8.89694059916782e-05j, -1.95045621471274e-05 - 7.78665768957823e-05j,
                           2.67258642661584e-06 - 5.44017464819609e-05j, 9.21593517512048e-06 - 2.57568133378709e-05j,
                           0.00000000000000 + 0.00000000000000j, -2.13334600231440e-05 + 1.58219722800374e-05j,
                           -4.83436699156886e-05 + 1.72976416851742e-05j, -7.33807944568332e-05 + 3.60496726524523e-06j,
                           -8.94109266075176e-05 - 2.23962712138049e-05j, -9.16460775666003e-05 - 5.49305449558449e-05j,
                           -7.86065881039440e-05 - 8.67290049452153e-05j, -5.23854671722149e-05 - 0.000110759764452844j,
                           -1.80756256633818e-05 - 0.000121855970107782j, 1.74838783641712e-05 - 0.000117866733854127j,
                           4.73329024749087e-05 - 0.000100077013950369j, 6.59993321669103e-05 - 7.28190415581433e-05j,
                           7.07192714292825e-05 - 4.23875000615032e-05j, 6.19956822418649e-05 - 1.55291099897508e-05j,
                           4.33836712451081e-05 + 2.13130309970622e-06j, 2.05730521629535e-05 + 7.36115576880687e-06j,
                           -1.54697628710127e-34 - 1.14731580839855e-34j, -1.26772324479803e-05 - 1.70932692110905e-05j,
                           -1.38808235745225e-05 - 3.87943030187625e-05j, -2.89724363035072e-06 - 5.89747489192983e-05j,
                           1.80262670745263e-05 - 7.19648921475164e-05j, 4.42773483583484e-05 - 7.38722928264127e-05j,
                           7.00101606184261e-05 - 6.34535108790868e-05j, 8.95363365337359e-05 - 4.23475333428084e-05j,
                           9.86453091348717e-05 - 1.46326493465467e-05j)

    def de_rotate_coefficients(self):
        samps_per_sym = 16
        rolloff = 0.5

        filter_size = len(self.ggp_coeffs)
        n = (len(self.ggp_coeffs) - 1) / 2

        tap_indices = range(0, filter_size)
        for i in tap_indices:
            k = (-n + i) / (2.0 * samps_per_sym)
            angle = 2 * np.pi * (1 + rolloff) * k
            self.ggp_coeffs_de_rotated[filter_size - 1 - i] = self.ggp_coeffs[i] / np.exp(1j * angle)

        phase_offset = np.angle(self.ggp_coeffs_de_rotated[160])
        center_tap = self.ggp_coeffs_de_rotated[160] / np.exp(1j * phase_offset)

        return
